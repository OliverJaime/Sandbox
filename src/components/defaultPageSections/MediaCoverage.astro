---
interface Article {
  logo: string;
  logoAlt: string;
  title: string;
  description: string;
  linkText: string;
  linkUrl: string;
  category: string;
}

interface Props {
  heading?: string;
  subheading?: string;
  articles: Article[];
  backgroundClass?: string;
}

const { 
  heading = "Media Coverage",
  subheading = "Explore recent RPT in the news segments showcasing our work, impact, and presence in the industry.",
  articles,
  backgroundClass = "bg-white"
} = Astro.props as Props;

// Group articles by category - REORDERED: TV, Print, Podcast, Online, All
const categories = ["TV", "Print", "Podcast", "Online", "All"];
const groupedArticles = {
  "TV": articles.filter(a => a.category === "TV"),
  "Print": articles.filter(a => a.category === "Print"),
  "Podcast": articles.filter(a => a.category === "Podcast"),
  "Online": articles.filter(a => a.category === "Online"),
  "All": articles,
};
---

<section id="media" class={`py-16 ${backgroundClass}`}>
  <div class="container mx-auto px-4 max-w-6xl">
    
    <!-- Section Header -->
    <div class="text-center mb-12">
      <h2 class="text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mb-4">{heading}</h2>
      <p class="text-lg text-gray-600 max-w-4xl mx-auto leading-relaxed">{subheading}</p>
    </div>

    <!-- Tab Navigation (IGN/Aescape Style) -->
    <div class="mb-8 overflow-x-auto scrollbar-hide">
      <div class="flex gap-2 border-b-2 border-gray-200 min-w-max">
        {categories.map((category, index) => (
          <button
            data-tab-btn
            data-category={category}
            class={`
              px-6 py-3 font-bold text-base transition-all duration-300 whitespace-nowrap relative
              ${index === 0 
                ? 'text-gray-900 border-b-4 border-cyan-600' 
                : 'text-gray-500 hover:text-gray-900 hover:bg-gray-50 border-b-4 border-transparent hover:border-gray-300'
              }
            `}
          >
            {category}
            {category !== "All" && (
              <span class="ml-2 text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">
                {groupedArticles[category].length}
              </span>
            )}
          </button>
        ))}
      </div>
    </div>

    <!-- Tab Content Panels -->
    <div class="relative">
      {categories.map((category, index) => (
        <div
          data-tab-content
          data-category={category}
          class={`tab-panel ${index === 0 ? 'active' : 'hidden'}`}
        >
          <div class="space-y-8">
            {groupedArticles[category].map((article) => (
              <article class="flex flex-col md:flex-row gap-6 pb-8 border-b border-gray-200 last:border-b-0 opacity-0 slide-in">
                
                <!-- Left: Logo (30%) -->
                <div class="md:w-[30%] flex items-start justify-center md:justify-start pt-2">
                  <img 
                    src={article.logo} 
                    alt={article.logoAlt}
                    class="max-w-40 h-auto object-contain"
                  />
                </div>

                <!-- Right: Content (70%) -->
                <div class="md:w-[70%]">
                  <h3 class="text-2xl font-bold text-gray-900 mb-3">{article.title}</h3>
                  <p class="text-gray-700 mb-4 leading-relaxed">{article.description}</p>
                  
                  <!-- CTA Link -->
                  <a 
                    href={article.linkUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center text-cyan-600 hover:text-cyan-700 font-semibold transition-colors duration-200"
                  >
                    {article.linkText}
                    <svg class="w-4 h-4 ml-2 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </a>
                </div>

              </article>
            ))}
          </div>
        </div>
      ))}
    </div>

  </div>
</section>

<!-- Tab Switching Script -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('[data-tab-btn]');
    const tabContents = document.querySelectorAll('[data-tab-content]');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const category = button.getAttribute('data-category');

        // Update button states
        tabButtons.forEach(btn => {
          const isActive = btn.getAttribute('data-category') === category;
          
          if (isActive) {
            btn.classList.remove('text-gray-500', 'border-transparent', 'hover:border-gray-300');
            btn.classList.add('text-gray-900', 'border-cyan-600');
          } else {
            btn.classList.remove('text-gray-900', 'border-cyan-600');
            btn.classList.add('text-gray-500', 'border-transparent');
          }
        });

        // Fade out current content
        const activeContent = document.querySelector('[data-tab-content].active');
        if (activeContent) {
          activeContent.classList.add('fade-out');
          
          setTimeout(() => {
            activeContent.classList.remove('active', 'fade-out');
            activeContent.classList.add('hidden');

            // Show new content with fade in
            tabContents.forEach(content => {
              if (content.getAttribute('data-category') === category) {
                content.classList.remove('hidden');
                content.classList.add('active', 'fade-in');
                
                // Animate articles sliding in
                const articles = content.querySelectorAll('article');
                articles.forEach((article, index) => {
                  setTimeout(() => {
                    article.classList.add('slide-in-active');
                  }, index * 100);
                });

                // Remove fade-in class after animation
                setTimeout(() => {
                  content.classList.remove('fade-in');
                }, 300);
              }
            });
          }, 200);
        }
      });
    });

    // Animate initial articles
    const initialArticles = document.querySelectorAll('.tab-panel.active article');
    initialArticles.forEach((article, index) => {
      setTimeout(() => {
        article.classList.add('slide-in-active');
      }, index * 100);
    });
  });
</script>

<style>
  /* Hide scrollbar but keep functionality */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Tab panel animations */
  .tab-panel {
    transition: opacity 0.3s ease-in-out;
  }

  .fade-out {
    opacity: 0;
  }

  .fade-in {
    opacity: 0;
    animation: fadeIn 0.3s ease-in-out forwards;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  /* Article slide-in animation */
  article.slide-in {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.4s ease-out, transform 0.4s ease-out;
  }

  article.slide-in-active {
    opacity: 1;
    transform: translateY(0);
  }

  /* Smooth hover effect on links */
  article a:hover svg {
    transform: translateX(4px);
  }

  /* Tab button active indicator animation */
  [data-tab-btn] {
    position: relative;
  }

  [data-tab-btn]:after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 4px;
    background-color: currentColor;
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  [data-tab-btn].border-cyan-600:after {
    transform: scaleX(1);
  }
</style>
