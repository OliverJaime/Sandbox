---
interface Props {
  highlightAreas?: ('cervical' | 'thoracic' | 'lumbar')[];
}

const { highlightAreas = [] } = Astro.props;
---

<div class="spine-container">
  <svg class="spine-svg" viewBox="0 0 300 900" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <!-- Gradients -->
      <radialGradient id="vGrad">
        <stop offset="0%" stop-color="#64C8FF" stop-opacity="0.8"/>
        <stop offset="100%" stop-color="#0EA5E9" stop-opacity="0.3"/>
      </radialGradient>
      <radialGradient id="pGrad">
        <stop offset="0%" stop-color="#FF6464" stop-opacity="0.95"/>
        <stop offset="100%" stop-color="#EF4444" stop-opacity="0.5"/>
      </radialGradient>
      <linearGradient id="bodyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="rgba(14, 165, 233, 0.15)"/>
        <stop offset="50%" stop-color="rgba(14, 165, 233, 0.08)"/>
        <stop offset="100%" stop-color="rgba(14, 165, 233, 0.12)"/>
      </linearGradient>
      <filter id="glow">
        <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
      <filter id="softGlow">
        <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>

    <!-- Human Body Silhouette -->
    <g class="body-outline" opacity="0.25">
      <!-- Head -->
      <ellipse cx="150" cy="45" rx="28" ry="35" fill="url(#bodyGrad)" stroke="rgba(14, 165, 233, 0.3)" stroke-width="1.5"/>
      
      <!-- Neck -->
      <path d="M 135 75 L 135 110 L 165 110 L 165 75" fill="url(#bodyGrad)" stroke="rgba(14, 165, 233, 0.3)" stroke-width="1.5"/>
      
      <!-- Shoulders and torso -->
      <ellipse cx="150" cy="130" rx="75" ry="25" fill="url(#bodyGrad)" stroke="rgba(14, 165, 233, 0.3)" stroke-width="1.5"/>
      
      <!-- Upper torso -->
      <path d="M 75 130 Q 70 250, 80 370 L 220 370 Q 230 250, 225 130" fill="url(#bodyGrad)" stroke="rgba(14, 165, 233, 0.3)" stroke-width="1.5"/>
      
      <!-- Waist/hips -->
      <ellipse cx="150" cy="390" rx="65" ry="35" fill="url(#bodyGrad)" stroke="rgba(14, 165, 233, 0.3)" stroke-width="1.5"/>
      
      <!-- Lower body -->
      <path d="M 90 410 Q 95 520, 110 650 M 210 410 Q 205 520, 190 650" fill="none" stroke="rgba(14, 165, 233, 0.25)" stroke-width="20" stroke-linecap="round"/>
      
      <!-- Arms suggestion -->
      <path d="M 75 150 Q 50 220, 45 280" fill="none" stroke="rgba(14, 165, 233, 0.2)" stroke-width="12" stroke-linecap="round"/>
      <path d="M 225 150 Q 250 220, 255 280" fill="none" stroke="rgba(14, 165, 233, 0.2)" stroke-width="12" stroke-linecap="round"/>
    </g>

    <!-- Spinal cord line with anatomical S-curve -->
    <path d="M 150 50 Q 140 100, 145 150 Q 148 200, 155 280 Q 160 360, 155 450 Q 152 540, 148 620 Q 145 680, 150 750" 
          fill="none" 
          stroke="rgba(14, 165, 233, 0.6)" 
          stroke-width="3" 
          class="cord"
          filter="url(#softGlow)"/>

    <!-- CERVICAL (Neck) - 7 vertebrae -->
    <g class="region cervical-region" data-region="cervical">
      <rect x="100" y="50" width="100" height="150" fill="transparent" class="hover-zone"/>
      
      <g class="vertebra" transform="translate(147, 65)">
        <ellipse rx="14" ry="10" class="v-body"/>
        <ellipse rx="7" ry="5" class="v-proc"/>
        <line x1="-10" y1="0" x2="-18" y2="-3" class="v-process-line"/>
        <line x1="10" y1="0" x2="18" y2="-3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(145, 88)">
        <ellipse rx="15" ry="11" class="v-body"/>
        <ellipse rx="7.5" ry="5.5" class="v-proc"/>
        <line x1="-11" y1="0" x2="-19" y2="-3" class="v-process-line"/>
        <line x1="11" y1="0" x2="19" y2="-3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(143, 111)">
        <ellipse rx="16" ry="11" class="v-body"/>
        <ellipse rx="8" ry="6" class="v-proc"/>
        <line x1="-11" y1="0" x2="-20" y2="-3" class="v-process-line"/>
        <line x1="11" y1="0" x2="20" y2="-3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(142, 134)">
        <ellipse rx="17" ry="12" class="v-body"/>
        <ellipse rx="8.5" ry="6" class="v-proc"/>
        <line x1="-12" y1="0" x2="-21" y2="-3" class="v-process-line"/>
        <line x1="12" y1="0" x2="21" y2="-3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(143, 157)">
        <ellipse rx="18" ry="12" class="v-body"/>
        <ellipse rx="9" ry="6" class="v-proc"/>
        <line x1="-13" y1="0" x2="-22" y2="-3" class="v-process-line"/>
        <line x1="13" y1="0" x2="22" y2="-3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(144, 180)">
        <ellipse rx="19" ry="13" class="v-body"/>
        <ellipse rx="9.5" ry="6.5" class="v-proc"/>
        <line x1="-14" y1="0" x2="-23" y2="-3" class="v-process-line"/>
        <line x1="14" y1="0" x2="23" y2="-3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(145, 203)">
        <ellipse rx="20" ry="14" class="v-body"/>
        <ellipse rx="10" ry="7" class="v-proc"/>
        <line x1="-14" y1="0" x2="-24" y2="-3" class="v-process-line"/>
        <line x1="14" y1="0" x2="24" y2="-3" class="v-process-line"/>
      </g>
    </g>

    <!-- THORACIC (Mid-back) - 12 vertebrae -->
    <g class="region thoracic-region" data-region="thoracic">
      <rect x="90" y="215" width="120" height="335" fill="transparent" class="hover-zone"/>
      
      <g class="vertebra" transform="translate(148, 230)">
        <ellipse rx="21" ry="15" class="v-body"/>
        <ellipse rx="10.5" ry="7.5" class="v-proc"/>
        <line x1="-15" y1="0" x2="-26" y2="-2" class="v-process-line"/>
        <line x1="15" y1="0" x2="26" y2="-2" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(150, 258)">
        <ellipse rx="22" ry="16" class="v-body"/>
        <ellipse rx="11" ry="8" class="v-proc"/>
        <line x1="-16" y1="0" x2="-28" y2="-2" class="v-process-line"/>
        <line x1="16" y1="0" x2="28" y2="-2" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(153, 286)">
        <ellipse rx="23" ry="16" class="v-body"/>
        <ellipse rx="11.5" ry="8" class="v-proc"/>
        <line x1="-17" y1="0" x2="-29" y2="-2" class="v-process-line"/>
        <line x1="17" y1="0" x2="29" y2="-2" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(156, 314)">
        <ellipse rx="24" ry="17" class="v-body"/>
        <ellipse rx="12" ry="8.5" class="v-proc"/>
        <line x1="-17" y1="0" x2="-30" y2="-1" class="v-process-line"/>
        <line x1="17" y1="0" x2="30" y2="-1" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(158, 342)">
        <ellipse rx="25" ry="17" class="v-body"/>
        <ellipse rx="12.5" ry="8.5" class="v-proc"/>
        <line x1="-18" y1="0" x2="-31" y2="-1" class="v-process-line"/>
        <line x1="18" y1="0" x2="31" y2="-1" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(160, 370)">
        <ellipse rx="26" ry="18" class="v-body"/>
        <ellipse rx="13" ry="9" class="v-proc"/>
        <line x1="-19" y1="0" x2="-32" y2="0" class="v-process-line"/>
        <line x1="19" y1="0" x2="32" y2="0" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(159, 398)">
        <ellipse rx="26" ry="18" class="v-body"/>
        <ellipse rx="13" ry="9" class="v-proc"/>
        <line x1="-19" y1="0" x2="-32" y2="1" class="v-process-line"/>
        <line x1="19" y1="0" x2="32" y2="1" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(157, 426)">
        <ellipse rx="27" ry="19" class="v-body"/>
        <ellipse rx="13.5" ry="9.5" class="v-proc"/>
        <line x1="-20" y1="0" x2="-33" y2="1" class="v-process-line"/>
        <line x1="20" y1="0" x2="33" y2="1" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(156, 454)">
        <ellipse rx="28" ry="19" class="v-body"/>
        <ellipse rx="14" ry="9.5" class="v-proc"/>
        <line x1="-20" y1="0" x2="-34" y2="2" class="v-process-line"/>
        <line x1="20" y1="0" x2="34" y2="2" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(155, 482)">
        <ellipse rx="29" ry="20" class="v-body"/>
        <ellipse rx="14.5" ry="10" class="v-proc"/>
        <line x1="-21" y1="0" x2="-35" y2="2" class="v-process-line"/>
        <line x1="21" y1="0" x2="35" y2="2" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(154, 510)">
        <ellipse rx="30" ry="20" class="v-body"/>
        <ellipse rx="15" ry="10" class="v-proc"/>
        <line x1="-22" y1="0" x2="-36" y2="3" class="v-process-line"/>
        <line x1="22" y1="0" x2="36" y2="3" class="v-process-line"/>
      </g>
      
      <g class="vertebra" transform="translate(152, 538)">
        <ellipse rx="31" ry="21" class="v-body"/>
        <ellipse rx="15.5" ry="10.5" class="v-proc"/>
        <line x1="-23" y1="0" x2="-37" y2="3" class="v-process-line"/>
        <line x1="23" y1="0" x2="37" y2="3" class="v-process-line"/>
      </g>
    </g>

    <!-- LUMBAR (Lower back) - 5 vertebrae - ENHANCED -->
    <g class="region lumbar-region" data-region="lumbar">
      <rect x="80" y="555" width="140" height="165" fill="transparent" class="hover-zone"/>
      
      <g class="vertebra lumbar-v" transform="translate(151, 570)">
        <ellipse rx="33" ry="23" class="v-body lumbar-body"/>
        <ellipse rx="16.5" ry="11.5" class="v-proc lumbar-proc"/>
        <line x1="-24" y1="0" x2="-40" y2="4" class="v-process-line lumbar-line"/>
        <line x1="24" y1="0" x2="40" y2="4" class="v-process-line lumbar-line"/>
        <!-- Enhanced spinous process -->
        <rect x="-4" y="-20" width="8" height="16" rx="2" class="spinous-process" fill="rgba(14, 165, 233, 0.4)"/>
      </g>
      
      <g class="vertebra lumbar-v" transform="translate(150, 605)">
        <ellipse rx="35" ry="24" class="v-body lumbar-body"/>
        <ellipse rx="17.5" ry="12" class="v-proc lumbar-proc"/>
        <line x1="-25" y1="0" x2="-42" y2="5" class="v-process-line lumbar-line"/>
        <line x1="25" y1="0" x2="42" y2="5" class="v-process-line lumbar-line"/>
        <rect x="-4.5" y="-22" width="9" height="18" rx="2" class="spinous-process" fill="rgba(14, 165, 233, 0.4)"/>
      </g>
      
      <g class="vertebra lumbar-v" transform="translate(149, 640)">
        <ellipse rx="37" ry="25" class="v-body lumbar-body"/>
        <ellipse rx="18.5" ry="12.5" class="v-proc lumbar-proc"/>
        <line x1="-27" y1="0" x2="-44" y2="6" class="v-process-line lumbar-line"/>
        <line x1="27" y1="0" x2="44" y2="6" class="v-process-line lumbar-line"/>
        <rect x="-5" y="-24" width="10" height="20" rx="2" class="spinous-process" fill="rgba(14, 165, 233, 0.4)"/>
      </g>
      
      <g class="vertebra lumbar-v" transform="translate(148, 675)">
        <ellipse rx="39" ry="26" class="v-body lumbar-body"/>
        <ellipse rx="19.5" ry="13" class="v-proc lumbar-proc"/>
        <line x1="-28" y1="0" x2="-46" y2="7" class="v-process-line lumbar-line"/>
        <line x1="28" y1="0" x2="46" y2="7" class="v-process-line lumbar-line"/>
        <rect x="-5.5" y="-26" width="11" height="22" rx="2" class="spinous-process" fill="rgba(14, 165, 233, 0.4)"/>
      </g>
      
      <g class="vertebra lumbar-v" transform="translate(148, 710)">
        <ellipse rx="41" ry="27" class="v-body lumbar-body"/>
        <ellipse rx="20.5" ry="13.5" class="v-proc lumbar-proc"/>
        <line x1="-30" y1="0" x2="-48" y2="8" class="v-process-line lumbar-line"/>
        <line x1="30" y1="0" x2="48" y2="8" class="v-process-line lumbar-line"/>
        <rect x="-6" y="-28" width="12" height="24" rx="2" class="spinous-process" fill="rgba(14, 165, 233, 0.4)"/>
      </g>
    </g>

    <!-- SACRUM & COCCYX -->
    <g class="sacrum-group" opacity="0.8">
      <ellipse cx="150" cy="750" rx="43" ry="30" class="v-body" opacity="0.9"/>
      <ellipse cx="150" cy="750" rx="22" ry="16" class="v-proc" opacity="0.7"/>
      <ellipse cx="150" cy="780" rx="30" ry="20" class="v-body" opacity="0.7"/>
      <ellipse cx="150" cy="780" rx="15" ry="10" class="v-proc" opacity="0.5"/>
    </g>
  </svg>

  </svg>

  <!-- Enhanced Glow overlays with region labels -->
  <div class="glow-overlay cervical-glow">
    <span class="region-label">Cervical</span>
  </div>
  <div class="glow-overlay thoracic-glow">
    <span class="region-label">Thoracic</span>
  </div>
  <div class="glow-overlay lumbar-glow">
    <span class="region-label">Lumbar</span>
  </div>
</div>

<script>
  // Enable hover highlighting with JavaScript fallback
  document.addEventListener('DOMContentLoaded', () => {
    const regions = document.querySelectorAll('.region');
    const glows = {
      'cervical': document.querySelector('.cervical-glow'),
      'thoracic': document.querySelector('.thoracic-glow'),
      'lumbar': document.querySelector('.lumbar-glow')
    };

    regions.forEach(region => {
      const regionType = region.getAttribute('data-region');
      const glowElement = glows[regionType];

      if (glowElement) {
        region.addEventListener('mouseenter', () => {
          glowElement.style.opacity = '1';
          glowElement.style.transform = 'scale(1.05)';
          const label = glowElement.querySelector('.region-label');
          if (label) label.style.opacity = '1';
        });

        region.addEventListener('mouseleave', () => {
          glowElement.style.opacity = '0';
          glowElement.style.transform = 'scale(1)';
          const label = glowElement.querySelector('.region-label');
          if (label) label.style.opacity = '0';
        });
      }
    });
  });
</script>

<style>
  .spine-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 500px;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding-left: 40px;
    opacity: 0.75;
    pointer-events: none;
    z-index: 0;
  }

  .spine-svg {
    width: 100%;
    max-width: 300px;
    height: 100%;
    filter: drop-shadow(0 0 15px rgba(14, 165, 233, 0.25));
  }

  .body-outline {
    transition: opacity 0.4s ease;
  }

  .glow-overlay {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0;
    transition: opacity 0.5s ease, transform 0.3s ease;
    pointer-events: none;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .region-label {
    font-size: 14px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.95);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    filter: blur(0);
    opacity: 0;
    transition: opacity 0.3s ease;
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
  }

  .cervical-glow {
    top: 7%;
    left: 110px;
    width: 180px;
    height: 140px;
    background: radial-gradient(ellipse, rgba(239, 68, 68, 0.7) 0%, rgba(239, 68, 68, 0.4) 40%, transparent 70%);
  }

  .thoracic-glow {
    top: 28%;
    left: 95px;
    width: 210px;
    height: 320px;
    background: radial-gradient(ellipse, rgba(251, 146, 60, 0.6) 0%, rgba(251, 146, 60, 0.35) 40%, transparent 70%);
  }

  .lumbar-glow {
    bottom: 18%;
    left: 105px;
    width: 220px;
    height: 180px;
    background: radial-gradient(ellipse, rgba(239, 68, 68, 0.85) 0%, rgba(239, 68, 68, 0.5) 35%, transparent 65%);
  }

  .cord {
    animation: cordGlow 4s ease-in-out infinite;
  }

  @keyframes cordGlow {
    0%, 100% { 
      stroke: rgba(14, 165, 233, 0.5);
      stroke-width: 3;
    }
    50% { 
      stroke: rgba(14, 165, 233, 0.8);
      stroke-width: 3.5;
    }
  }

  .v-body {
    fill: url(#vGrad);
    stroke: rgba(14, 165, 233, 0.9);
    stroke-width: 1.5;
    transition: all 0.35s ease;
    animation: float 4s ease-in-out infinite, breathe 3s ease-in-out infinite;
  }

  .v-proc {
    fill: rgba(14, 165, 233, 0.45);
    stroke: rgba(14, 165, 233, 0.75);
    stroke-width: 1;
    transition: all 0.35s ease;
    animation: float 4s ease-in-out infinite, breathe 3s ease-in-out infinite;
  }

  .v-process-line {
    stroke: rgba(14, 165, 233, 0.6);
    stroke-width: 2;
    transition: all 0.35s ease;
  }

  /* Enhanced lumbar styling */
  .lumbar-body {
    stroke-width: 2;
    filter: drop-shadow(0 0 6px rgba(14, 165, 233, 0.4));
  }

  .lumbar-proc {
    fill: rgba(14, 165, 233, 0.55);
  }

  .lumbar-line {
    stroke-width: 2.5;
  }

  .spinous-process {
    stroke: rgba(14, 165, 233, 0.7);
    stroke-width: 1;
    transition: all 0.35s ease;
  }

  @keyframes float {
    0%, 100% {
      transform: translateY(0);
      opacity: 1;
    }
    50% {
      transform: translateY(-4px);
      opacity: 0.92;
    }
  }

  @keyframes breathe {
    0%, 100% {
      filter: drop-shadow(0 0 4px rgba(14, 165, 233, 0.3));
    }
    50% {
      filter: drop-shadow(0 0 10px rgba(14, 165, 233, 0.6));
    }
  }

  .vertebra {
    animation-delay: calc(var(--vertebra-index, 0) * 0.08s);
  }

  .region {
    pointer-events: auto;
    cursor: pointer;
  }

  .hover-zone {
    opacity: 0;
  }

  /* Hover states */
  .region:hover .v-body {
    fill: url(#pGrad);
    stroke: rgba(239, 68, 68, 1);
    stroke-width: 2.5;
    filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.9)) url(#glow);
    animation: pulse 1.2s ease-in-out infinite;
  }

  .region:hover .v-proc {
    fill: rgba(251, 146, 60, 0.8);
    stroke: rgba(251, 146, 60, 1);
    stroke-width: 1.5;
    filter: drop-shadow(0 0 14px rgba(251, 146, 60, 0.85));
    animation: pulse 1.2s ease-in-out infinite;
  }

  .region:hover .v-process-line {
    stroke: rgba(251, 146, 60, 0.9);
    stroke-width: 3;
    filter: drop-shadow(0 0 8px rgba(251, 146, 60, 0.7));
  }

  .region:hover .spinous-process {
    fill: rgba(251, 146, 60, 0.7);
    stroke: rgba(251, 146, 60, 1);
    stroke-width: 1.5;
  }

  /* Enhanced lumbar hover */
  .lumbar-region:hover .lumbar-body {
    stroke-width: 3.5;
    filter: drop-shadow(0 0 25px rgba(239, 68, 68, 1)) url(#glow);
  }

  .lumbar-region:hover .lumbar-proc {
    fill: rgba(251, 146, 60, 0.9);
  }

  .lumbar-region:hover .lumbar-line {
    stroke-width: 4;
  }

  .cervical-region:hover + .glow-overlay.cervical-glow,
  .spine-container:has(.cervical-region:hover) .cervical-glow {
    opacity: 1;
    transform: scale(1.05);
  }

  .thoracic-region:hover + .glow-overlay.thoracic-glow,
  .spine-container:has(.thoracic-region:hover) .thoracic-glow {
    opacity: 1;
    transform: scale(1.05);
  }

  .lumbar-region:hover + .glow-overlay.lumbar-glow,
  .spine-container:has(.lumbar-region:hover) .lumbar-glow {
    opacity: 1;
    transform: scale(1.05);
  }

  .spine-container:has(.cervical-region:hover) .cervical-glow .region-label,
  .spine-container:has(.thoracic-region:hover) .thoracic-glow .region-label,
  .spine-container:has(.lumbar-region:hover) .lumbar-glow .region-label {
    opacity: 1;
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.15);
    }
  }

  /* Responsive adjustments */
  @media (max-width: 1280px) {
    .spine-container {
      width: 420px;
      padding-left: 30px;
      opacity: 0.7;
    }
    .spine-svg {
      max-width: 260px;
    }
  }

  @media (max-width: 1024px) {
    .spine-container {
      width: 360px;
      padding-left: 25px;
      opacity: 0.65;
    }
    .spine-svg {
      max-width: 220px;
    }
    .glow-overlay {
      filter: blur(60px);
    }
  }

  @media (max-width: 768px) {
    .spine-container {
      width: 280px;
      padding-left: 15px;
      opacity: 0.5;
    }
    .spine-svg {
      max-width: 180px;
    }
    .region {
      pointer-events: none;
    }
    .glow-overlay {
      display: none;
    }
    .body-outline {
      opacity: 0.15;
    }
  }

  @media (max-width: 640px) {
    .spine-container {
      width: 220px;
      padding-left: 10px;
      opacity: 0.4;
    }
    .spine-svg {
      max-width: 140px;
    }
  }
</style>